#PCA
PCA_int<-prcomp(t(log2(comb_fpkm+1)), scale = F, center = T, retx=T)
PCA_results<-PCA_int$x
summa<-summary(PCA_int)
col<-comb_fpkm_col
highest_variance_PCA<-PCA_results[,1:15]
tsne_withOligos<-tsne(highest_variance_PCA)
data<-data.frame(x=tsne_withOligos[,1],y=tsne_withOligos[,2],factors=colnames(comb_fpkm),col=col)
data$factors<-as.character(data$factors)
data$factors <- factor(data$factors, levels=unique(data$factors), ordered = T)
p<-ggplot(data)
#p<-p+geom_text(aes(x=data$x,y=data$y),label=data$factors,color=data$col)
p<-p+geom_point(aes(x=data$x,y=data$y),color=data$col,size=5,alpha=0.65)
p<-p+theme_classic()
p<- p+ labs(y = "t-SNE component #2", x = "t-SNE component #1")
p<-p+theme(axis.text.x=element_text(size=20))
p<-p+theme(axis.title.x=element_text(size=24))
p<-p+theme(axis.text.y=element_text(size=20))
p<-p+theme(axis.title.y=element_text(size=24))
p<-p+theme(axis.title.y=element_text(vjust=1))
p<-p+theme(axis.title.x=element_text(vjust=-0.10))
p
highest_variance_PCA<-PCA_results[,1:18]
tsne_withOligos<-tsne(highest_variance_PCA)
data<-data.frame(x=tsne_withOligos[,1],y=tsne_withOligos[,2],factors=colnames(comb_fpkm),col=col)
data$factors<-as.character(data$factors)
data$factors <- factor(data$factors, levels=unique(data$factors), ordered = T)
p<-ggplot(data)
#p<-p+geom_text(aes(x=data$x,y=data$y),label=data$factors,color=data$col)
p<-p+geom_point(aes(x=data$x,y=data$y),color=data$col,size=5,alpha=0.65)
p<-p+theme_classic()
p<- p+ labs(y = "t-SNE component #2", x = "t-SNE component #1")
p<-p+theme(axis.text.x=element_text(size=20))
p<-p+theme(axis.title.x=element_text(size=24))
p<-p+theme(axis.text.y=element_text(size=20))
p<-p+theme(axis.title.y=element_text(size=24))
p<-p+theme(axis.title.y=element_text(vjust=1))
p<-p+theme(axis.title.x=element_text(vjust=-0.10))
p
highest_variance_PCA<-PCA_results[,1:8]
tsne_withOligos<-tsne(highest_variance_PCA)
data<-data.frame(x=tsne_withOligos[,1],y=tsne_withOligos[,2],factors=colnames(comb_fpkm),col=col)
data$factors<-as.character(data$factors)
data$factors <- factor(data$factors, levels=unique(data$factors), ordered = T)
p<-ggplot(data)
#p<-p+geom_text(aes(x=data$x,y=data$y),label=data$factors,color=data$col)
p<-p+geom_point(aes(x=data$x,y=data$y),color=data$col,size=5,alpha=0.65)
p<-p+theme_classic()
p<- p+ labs(y = "t-SNE component #2", x = "t-SNE component #1")
p<-p+theme(axis.text.x=element_text(size=20))
p<-p+theme(axis.title.x=element_text(size=24))
p<-p+theme(axis.text.y=element_text(size=20))
p<-p+theme(axis.title.y=element_text(size=24))
p<-p+theme(axis.title.y=element_text(vjust=1))
p<-p+theme(axis.title.x=element_text(vjust=-0.10))
p
rm(list=ls())
library(ggplot2)
setwd("/Users/bendulken/Documents/Experiments/FACS Single Cell/02102016_GFAP_Gradient_Sort_qPCR/All_sorts/")
rm(list=ls())
library(ggplot2)
setwd("/Users/bendulken/Documents/Experiments/FACS Single Cell/02102016_GFAP_Gradient_Sort_qPCR/All_sorts/")
expression<-read.table("GFP_expression_average_sort1_sort3.txt",header=T)
#Experiment #4 plotted alone
factor<-factor(c(rep(c("GFAP-high\naNSC","GFAP-mid\naNSC","GFAP-low\naNSC","NPC"),2)))
color<-factor(c(rep(c("#c9cc00","#ff9933","#ff3333","#00CCFF"),2)))
exp_color<-factor(c(rep("#000000",8)))
for(i in 1:length(expression_3[,1])){
#expression_expanded<-c(rep(expression_compressed[,i+1],4))
#data<-data.frame(t(expression[i,]),expression_expanded,factor=factor,color=color)
data<-data.frame(t(expression_3[i,]),factor=factor,color=color)
data$factor<-as.character(data$factor)
data$factor <- factor(data$factor, levels=unique(data$factor), ordered = T)
data$color<-as.character(data$color)
data$color <- factor(data$color, levels=unique(data$color), ordered = T)
p<-ggplot(data)
p<-p+geom_boxplot(aes(x=factor,y=data[,1], fill=color))
p<-p+geom_point(aes(x=factor,y=data[,1]),color=exp_color,size=5,alpha=0.7)
#p<-p+geom_line(inheret.aes = FALSE,aes(x=factor,y=data[,2],group=exp_color,color=exp_color),size=1.5)
p<-p+theme_classic()
p<-p+labs(y="Gene expression\n(normalized to B-Actin)")
p<-p+theme(legend.position = "none")
p<-p+theme(axis.text.x=element_text(size=18))
p<-p+theme(axis.title.x=element_blank())
p<-p+theme(axis.text.y=element_text(size=22))
p<-p+theme(axis.title.y=element_text(size=20))
p<-p+theme(plot.title=element_text(size=22))
p<-p+scale_fill_manual(values=c("#c9cc00","#ff9933","#ff3333","#00CCFF","#3333ff"))
p<-p+scale_color_manual(values=c("#009933","#666699","#000000"))
pdf(paste(colnames(data)[1],"_sort1_sort3_aggregated.pdf",sep=""),width=8,height=4.5)
print(p)
dev.off()
}
library(ggplot2)
setwd("/Users/bendulken/Documents/Experiments/FACS Single Cell/02102016_GFAP_Gradient_Sort_qPCR/All_sorts/")
expression<-read.table("GFP_expression_average_sort1_sort3.txt",header=T)
#Experiment #4 plotted alone
factor<-factor(c(rep(c("GFAP-high\naNSC","GFAP-mid\naNSC","GFAP-low\naNSC","NPC"),2)))
color<-factor(c(rep(c("#c9cc00","#ff9933","#ff3333","#00CCFF"),2)))
exp_color<-factor(c(rep("#000000",8)))
for(i in 1:length(expression[,1])){
#expression_expanded<-c(rep(expression_compressed[,i+1],4))
#data<-data.frame(t(expression[i,]),expression_expanded,factor=factor,color=color)
data<-data.frame(t(expression[i,]),factor=factor,color=color)
data$factor<-as.character(data$factor)
data$factor <- factor(data$factor, levels=unique(data$factor), ordered = T)
data$color<-as.character(data$color)
data$color <- factor(data$color, levels=unique(data$color), ordered = T)
p<-ggplot(data)
p<-p+geom_boxplot(aes(x=factor,y=data[,1], fill=color))
p<-p+geom_point(aes(x=factor,y=data[,1]),color=exp_color,size=5,alpha=0.7)
#p<-p+geom_line(inheret.aes = FALSE,aes(x=factor,y=data[,2],group=exp_color,color=exp_color),size=1.5)
p<-p+theme_classic()
p<-p+labs(y="Gene expression\n(normalized to B-Actin)")
p<-p+theme(legend.position = "none")
p<-p+theme(axis.text.x=element_text(size=18))
p<-p+theme(axis.title.x=element_blank())
p<-p+theme(axis.text.y=element_text(size=22))
p<-p+theme(axis.title.y=element_text(size=20))
p<-p+theme(plot.title=element_text(size=22))
p<-p+scale_fill_manual(values=c("#c9cc00","#ff9933","#ff3333","#00CCFF","#3333ff"))
p<-p+scale_color_manual(values=c("#009933","#666699","#000000"))
pdf(paste(colnames(data)[1],"_sort1_sort3_aggregated.pdf",sep=""),width=8,height=4.5)
print(p)
dev.off()
}
library(ggplot2)
setwd("/Users/bendulken/Documents/Experiments/FACS Single Cell/02102016_GFAP_Gradient_Sort_qPCR/All_sorts/")
expression<-read.table("GFP_expression_average_sort1_sort3_noNPC.txt",header=T)
#Experiment #4 plotted alone
factor<-factor(c(rep(c("GFAP-high\naNSC","GFAP-mid\naNSC","GFAP-low\naNSC","NPC"),2)))
color<-factor(c(rep(c("#c9cc00","#ff9933","#ff3333","#00CCFF"),2)))
exp_color<-factor(c(rep("#000000",8)))
for(i in 1:length(expression[,1])){
#expression_expanded<-c(rep(expression_compressed[,i+1],4))
#data<-data.frame(t(expression[i,]),expression_expanded,factor=factor,color=color)
data<-data.frame(t(expression[i,]),factor=factor,color=color)
data$factor<-as.character(data$factor)
data$factor <- factor(data$factor, levels=unique(data$factor), ordered = T)
data$color<-as.character(data$color)
data$color <- factor(data$color, levels=unique(data$color), ordered = T)
p<-ggplot(data)
p<-p+geom_boxplot(aes(x=factor,y=data[,1], fill=color))
p<-p+geom_point(aes(x=factor,y=data[,1]),color=exp_color,size=5,alpha=0.7)
#p<-p+geom_line(inheret.aes = FALSE,aes(x=factor,y=data[,2],group=exp_color,color=exp_color),size=1.5)
p<-p+theme_classic()
p<-p+labs(y="Gene expression\n(normalized to B-Actin)")
p<-p+theme(legend.position = "none")
p<-p+theme(axis.text.x=element_text(size=18))
p<-p+theme(axis.title.x=element_blank())
p<-p+theme(axis.text.y=element_text(size=22))
p<-p+theme(axis.title.y=element_text(size=20))
p<-p+theme(plot.title=element_text(size=22))
p<-p+scale_fill_manual(values=c("#c9cc00","#ff9933","#ff3333","#00CCFF","#3333ff"))
p<-p+scale_color_manual(values=c("#009933","#666699","#000000"))
pdf(paste(colnames(data)[1],"_sort1_sort3_aggregated_nonpc.pdf",sep=""),width=8,height=4.5)
print(p)
dev.off()
}
library(ggplot2)
setwd("/Users/bendulken/Documents/Experiments/FACS Single Cell/02102016_GFAP_Gradient_Sort_qPCR/All_sorts/")
expression<-read.table("GFP_expression_average_sort1_sort3_noNPC.txt",header=T)
#Experiment #4 plotted alone
factor<-factor(c(rep(c("GFAP-high\naNSC","GFAP-mid\naNSC","GFAP-low\naNSC"),2)))
color<-factor(c(rep(c("#c9cc00","#ff9933","#ff3333"),2)))
exp_color<-factor(c(rep("#000000",6)))
for(i in 1:length(expression[,1])){
#expression_expanded<-c(rep(expression_compressed[,i+1],4))
#data<-data.frame(t(expression[i,]),expression_expanded,factor=factor,color=color)
data<-data.frame(t(expression[i,]),factor=factor,color=color)
data$factor<-as.character(data$factor)
data$factor <- factor(data$factor, levels=unique(data$factor), ordered = T)
data$color<-as.character(data$color)
data$color <- factor(data$color, levels=unique(data$color), ordered = T)
p<-ggplot(data)
p<-p+geom_boxplot(aes(x=factor,y=data[,1], fill=color))
p<-p+geom_point(aes(x=factor,y=data[,1]),color=exp_color,size=5,alpha=0.7)
#p<-p+geom_line(inheret.aes = FALSE,aes(x=factor,y=data[,2],group=exp_color,color=exp_color),size=1.5)
p<-p+theme_classic()
p<-p+labs(y="Gene expression\n(normalized to B-Actin)")
p<-p+theme(legend.position = "none")
p<-p+theme(axis.text.x=element_text(size=18))
p<-p+theme(axis.title.x=element_blank())
p<-p+theme(axis.text.y=element_text(size=22))
p<-p+theme(axis.title.y=element_text(size=20))
p<-p+theme(plot.title=element_text(size=22))
p<-p+scale_fill_manual(values=c("#c9cc00","#ff9933","#ff3333","#00CCFF","#3333ff"))
p<-p+scale_color_manual(values=c("#009933","#666699","#000000"))
pdf(paste(colnames(data)[1],"_sort1_sort3_aggregated_nonpc.pdf",sep=""),width=8,height=4.5)
print(p)
dev.off()
}
expression
setwd("/Users/bendulken/Documents/Experiments/FACS Single Cell/02102016_GFAP_Gradient_Sort_qPCR/All_sorts/")
expression<-read.table("GFP_expression_average_sort1_sort3_noNPC.txt",header=T)
library(ggplot2)
setwd("/Users/bendulken/Documents/Experiments/FACS Single Cell/02102016_GFAP_Gradient_Sort_qPCR/All_sorts/")
expression<-read.table("GFP_expression_average_sort1_sort3_noNPC.txt",header=T)
#Experiment #4 plotted alone
factor<-factor(c(rep(c("GFAP-high\naNSC","GFAP-mid\naNSC","GFAP-low\naNSC"),2)))
color<-factor(c(rep(c("#c9cc00","#ff9933","#ff3333"),2)))
exp_color<-factor(c(rep("#000000",6)))
for(i in 1:length(expression[,1])){
#expression_expanded<-c(rep(expression_compressed[,i+1],4))
#data<-data.frame(t(expression[i,]),expression_expanded,factor=factor,color=color)
data<-data.frame(t(expression[i,]),factor=factor,color=color)
data$factor<-as.character(data$factor)
data$factor <- factor(data$factor, levels=unique(data$factor), ordered = T)
data$color<-as.character(data$color)
data$color <- factor(data$color, levels=unique(data$color), ordered = T)
p<-ggplot(data)
p<-p+geom_boxplot(aes(x=factor,y=data[,1], fill=color))
p<-p+geom_point(aes(x=factor,y=data[,1]),color=exp_color,size=5,alpha=0.7)
#p<-p+geom_line(inheret.aes = FALSE,aes(x=factor,y=data[,2],group=exp_color,color=exp_color),size=1.5)
p<-p+theme_classic()
p<-p+labs(y="Gene expression\n(normalized to B-Actin)")
p<-p+theme(legend.position = "none")
p<-p+theme(axis.text.x=element_text(size=18))
p<-p+theme(axis.title.x=element_blank())
p<-p+theme(axis.text.y=element_text(size=22))
p<-p+theme(axis.title.y=element_text(size=20))
p<-p+theme(plot.title=element_text(size=22))
p<-p+scale_fill_manual(values=c("#c9cc00","#ff9933","#ff3333","#00CCFF","#3333ff"))
p<-p+scale_color_manual(values=c("#009933","#666699","#000000"))
pdf(paste(colnames(data)[1],"_sort1_sort3_aggregated_nonpc.pdf",sep=""),width=8,height=4.5)
print(p)
dev.off()
}
#Reading in NS and specific population cells
rm(list=ls())
library(ggplot2)
library(edgeR)
library(ConsensusClusterPlus)
library(monocle)
source("/Volumes/guacamole/Software/Final Scripts for Paper _ 01152015/Files/Functions/09282015_plot_spanning_tree_mod.R")
source("/Volumes/guacamole/Software/Final Scripts for Paper _ 01152015/Files/Functions/09282015_plot_genes_in_pseudotime_mod.txt")
#Loading all high quality cells and filtering for lowly expressed genes and cell cycle genes
setwd("/Volumes/guacamole/Software/Final Scripts for Paper _ 01152015/Files")
allcounts_allcells<-read.table("AllCounts_specPops_read_gene_ERCC_filt_FINAL.txt")
setwd("/Volumes/guacamole/Software/Final Scripts for Paper _ 01152015/Files")
oligos<-as.vector(read.table("STAR_oligos_updated_09232015.txt")[,1])
allcounts_allcells_nooligo<-allcounts_allcells[,-na.omit(match(oligos,colnames(allcounts_allcells)))]
allcounts_allcells_nooligo_noast<-allcounts_allcells_nooligo[,!grepl("Ast",colnames(allcounts_allcells_nooligo))]
#Filtering for expressed by 5 cells at 10 counts
greaterthan0<-allcounts_allcells_nooligo_noast>10
greaterthan0sum<-rowSums(greaterthan0)
allcounts_allcells_nooligo_noast_genefilt<-allcounts_allcells_nooligo_noast[greaterthan0sum>=5,]
gfp_mapped<-read.table("Allcounts_GFP_mapped.txt")
gfp_mapped_nooligo<-gfp_mapped[,match(colnames(allcounts_allcells_nooligo_noast),colnames(gfp_mapped))]
gfp_mapped_nooligo_noERCC<-gfp_mapped_nooligo[!grepl("ERCC",rownames(gfp_mapped_nooligo)),]
greaterthan0<-gfp_mapped_nooligo_noERCC>10
greaterthan0sum<-rowSums(greaterthan0)
gfp_mapped_nooligo_noERCC_genefilt<-gfp_mapped_nooligo_noERCC[greaterthan0sum>=5,]
glm <- DGEList(counts=gfp_mapped_nooligo_noERCC_genefilt)
glm.norm <- calcNormFactors(glm,method="TMM")
load("/Volumes/guacamole/Software/Final Scripts for Paper _ 01152015/Files/Katja_exonic_gene_sizes_ERCC92.RData")
names(exonic.gene.sizes) <- tolower(names(exonic.gene.sizes))
exonic.gene.sizes.2<-c(exonic.gene.sizes,720)
names(exonic.gene.sizes.2)<-c(names(exonic.gene.sizes),'gfp')
ind <- match(tolower(rownames(glm.norm)), names(exonic.gene.sizes.2))
exonic.gene.sizes.ord <- exonic.gene.sizes.2[ind]
genes <- data.frame(gene.symbol=rownames(glm.norm),
exonic.size=exonic.gene.sizes.ord)
fpkm_glm_genefilt_nooligo_gfp <- rpkm(glm.norm, gene.length=genes$exonic.size,
normalized.lib.sizes=T, log=F)
setwd("/Volumes/guacamole/Software/Final Scripts for Paper _ 01152015/Files/Ordering")
group1<-as.vector(read.table("group1_10282015_50minModels_quiescent1_consensus_2.txt")[,1])
group2<-as.vector(read.table("group2_10282015_50minModels_active_nondividing_consensus_2.txt")[,1])
group3<-as.vector(read.table("group3_10282015_50minModels_active_dividing_early_consensus_2.txt")[,1])
group4<-as.vector(read.table("group4_10282015_50minModels_active_dividing_late_consensus_2.txt")[,1])
group5<-as.vector(read.table("group5_10282015_50minModels_active_dividing_consensus_2.txt")[,1])
group1_fpkm<-fpkm_glm_genefilt_nooligo_gfp[,match(group1,colnames(fpkm_glm_genefilt_nooligo_gfp))]
group2_fpkm<-fpkm_glm_genefilt_nooligo_gfp[,match(group2,colnames(fpkm_glm_genefilt_nooligo_gfp))]
group3_fpkm<-fpkm_glm_genefilt_nooligo_gfp[,match(group3,colnames(fpkm_glm_genefilt_nooligo_gfp))]
group4_fpkm<-fpkm_glm_genefilt_nooligo_gfp[,match(group4,colnames(fpkm_glm_genefilt_nooligo_gfp))]
group5_fpkm<-fpkm_glm_genefilt_nooligo_gfp[,match(group5,colnames(fpkm_glm_genefilt_nooligo_gfp))]
comb_fpkm<-cbind(group1_fpkm,group2_fpkm,group3_fpkm,group4_fpkm,group5_fpkm)
#c("#9966FF","#c9cc00","#ff9933","#ff3333","#00CCFF")
comb_fpkm_col<-vector(length=length(comb_fpkm[1,]),mode="character")
comb_fpkm_col[match(group1,colnames(comb_fpkm))]<-"#9966FF"
comb_fpkm_col[match(group2,colnames(comb_fpkm))]<-"#c9cc00"
comb_fpkm_col[match(group3,colnames(comb_fpkm))]<-"#ff9933"
comb_fpkm_col[match(group4,colnames(comb_fpkm))]<-"#ff3333"
comb_fpkm_col[match(group5,colnames(comb_fpkm))]<-"#00CCFF"
comb_fac_col<-vector(length=length(comb_fpkm[1,]),mode="character")
comb_fac_col[match(group1,colnames(comb_fpkm))]<-"qNSC-like"
comb_fac_col[match(group2,colnames(comb_fpkm))]<-"aNSC-early"
comb_fac_col[match(group3,colnames(comb_fpkm))]<-"aNSC-mid"
comb_fac_col[match(group4,colnames(comb_fpkm))]<-"aNSC-late"
comb_fac_col[match(group5,colnames(comb_fpkm))]<-"NPC-like"
#Larger plots used for Figure 4E, 4F
setwd("/Volumes/guacamole/Software/Final Scripts for Paper _ 01152015/GFP_mapping")
int_genes<-c("Dlx2","Dlx1","Jag1","Notch2","Atp1a2","Ntsr2","Gja1","Ascl1","Cdk1","Notch2","Notch1","Dcx","Tubb3","Lgr4","Serpine2","Fgfr3","Fgfr2","Dlx6as1","Egfr","GFP")
for(i in 1:length(int_genes)){
int_fpkm_glm<-comb_fpkm[match(int_genes,rownames(comb_fpkm)),]
dataframe<-data.frame(data=log2(int_fpkm_glm[i,]+1),col=comb_fpkm_col,fac=comb_fac_col)
dataframe$col<-as.character(dataframe$col)
dataframe$col <- factor(dataframe$col, levels=unique(dataframe$col), ordered = T)
dataframe$fac<-as.character(dataframe$fac)
dataframe$fac <- factor(dataframe$fac, levels=unique(dataframe$fac), ordered = T)
p<-ggplot(dataframe)
p<-p+geom_violin(aes(x=dataframe$fac,y=dataframe$data,fill=dataframe$col),trim=F,scale="width",alpha=0.5,width=0.5)+geom_jitter(aes(x=dataframe$fac,y=dataframe$data),position = position_jitter(width = .3))
p<-p+theme_classic()
p<-p + theme(legend.position="none")
p<-p+scale_x_discrete(labels=c("qNSC-\nlike","aNSC-\nearly","aNSC-\nmid","aNSC-\nlate","NPC-\nlike"))
p<-p+theme(axis.text.y=element_text(size=15))
p<-p+theme(axis.text.x=element_text(size=20))
p<-p+theme(axis.title=element_text(size=20))
p<-p+theme(axis.title.y=element_text(vjust=1))
p<-p+theme(axis.title.x=element_text(vjust=-0.10))
p<-p+labs(y="log2(FPKM+1)")
p<-p+theme(axis.title.x=element_blank())
p<-p+scale_fill_manual(values=c("#9966FF","#c9cc00","#ff9933","#ff3333","#00CCFF"))
pdf(paste(rownames(int_fpkm_glm)[i],"_gfp_mapping.pdf",sep=""),width=10,height=4)
print(p)
dev.off()
}
#==========================================================================================================
setwd("/Volumes/guacamole/Software/Final Scripts for Paper _ 01152015/Files/Ordering")
group1<-as.vector(read.table("group1_10282015_50minModels_quiescent1_consensus_2.txt")[,1])
group2<-as.vector(read.table("group2_10282015_50minModels_active_nondividing_consensus_2.txt")[,1])
group3<-as.vector(read.table("group3_10282015_50minModels_active_dividing_early_consensus_2.txt")[,1])
group4<-as.vector(read.table("group4_10282015_50minModels_active_dividing_late_consensus_2.txt")[,1])
group5<-as.vector(read.table("group5_10282015_50minModels_active_dividing_consensus_2.txt")[,1])
group1_fpkm<-fpkm_glm_genefilt_nooligo_gfp[,match(group1,colnames(fpkm_glm_genefilt_nooligo_gfp))]
group2_fpkm<-fpkm_glm_genefilt_nooligo_gfp[,match(group2,colnames(fpkm_glm_genefilt_nooligo_gfp))]
group3_fpkm<-fpkm_glm_genefilt_nooligo_gfp[,match(group3,colnames(fpkm_glm_genefilt_nooligo_gfp))]
group4_fpkm<-fpkm_glm_genefilt_nooligo_gfp[,match(group4,colnames(fpkm_glm_genefilt_nooligo_gfp))]
group5_fpkm<-fpkm_glm_genefilt_nooligo_gfp[,match(group5,colnames(fpkm_glm_genefilt_nooligo_gfp))]
comb_fpkm<-cbind(group3_fpkm,group4_fpkm)
#c("#9966FF","#c9cc00","#ff9933","#ff3333","#00CCFF")
comb_fpkm_col<-vector(length=length(comb_fpkm[1,]),mode="character")
comb_fpkm_col[match(group1,colnames(comb_fpkm))]<-"#9966FF"
comb_fpkm_col[match(group2,colnames(comb_fpkm))]<-"#c9cc00"
comb_fpkm_col[match(group3,colnames(comb_fpkm))]<-"#ff9933"
comb_fpkm_col[match(group4,colnames(comb_fpkm))]<-"#ff3333"
comb_fpkm_col[match(group5,colnames(comb_fpkm))]<-"#00CCFF"
comb_fac_col<-vector(length=length(comb_fpkm[1,]),mode="character")
comb_fac_col[match(group1,colnames(comb_fpkm))]<-"qNSC-like"
comb_fac_col[match(group2,colnames(comb_fpkm))]<-"aNSC-early"
comb_fac_col[match(group3,colnames(comb_fpkm))]<-"aNSC-mid"
comb_fac_col[match(group4,colnames(comb_fpkm))]<-"aNSC-late"
comb_fac_col[match(group5,colnames(comb_fpkm))]<-"NPC-like"
#Larger plots used for Figure 4E, 4F
setwd("/Volumes/guacamole/Software/Final Scripts for Paper _ 01152015/GFP_mapping")
int_genes<-c("Dlx2","Dlx1","Jag1","Notch2","Atp1a2","Ntsr2","Gja1","Ascl1","Cdk1","Notch2","Notch1","Dcx","Tubb3","Lgr4","Serpine2","Fgfr3","Fgfr2","Dlx6as1","Egfr","GFP")
for(i in 1:length(int_genes)){
int_fpkm_glm<-comb_fpkm[match(int_genes,rownames(comb_fpkm)),]
dataframe<-data.frame(data=log2(int_fpkm_glm[i,]+1),col=comb_fpkm_col,fac=comb_fac_col)
dataframe$col<-as.character(dataframe$col)
dataframe$col <- factor(dataframe$col, levels=unique(dataframe$col), ordered = T)
dataframe$fac<-as.character(dataframe$fac)
dataframe$fac <- factor(dataframe$fac, levels=unique(dataframe$fac), ordered = T)
p<-ggplot(dataframe)
p<-p+geom_violin(aes(x=dataframe$fac,y=dataframe$data,fill=dataframe$col),trim=F,scale="width",alpha=0.5,width=0.5)+geom_jitter(aes(x=dataframe$fac,y=dataframe$data),position = position_jitter(width = .3))
p<-p+theme_classic()
p<-p + theme(legend.position="none")
p<-p+scale_x_discrete(labels=c("aNSC-\nmid","aNSC-\nlate"))
p<-p+theme(axis.text.y=element_text(size=15))
p<-p+theme(axis.text.x=element_text(size=20))
p<-p+theme(axis.title=element_text(size=20))
p<-p+theme(axis.title.y=element_text(vjust=1))
p<-p+theme(axis.title.x=element_text(vjust=-0.10))
p<-p+labs(y="log2(FPKM+1)")
p<-p+theme(axis.title.x=element_blank())
p<-p+scale_fill_manual(values=c("#ff9933","#ff3333"))
pdf(paste(rownames(int_fpkm_glm)[i],"_gfp_mapping.pdf",sep=""),width=10,height=4)
print(p)
dev.off()
}
#Reading in NS and specific population cells
rm(list=ls())
library(ggplot2)
library(edgeR)
library(ConsensusClusterPlus)
library(monocle)
source("/Volumes/guacamole/Software/Final Scripts for Paper _ 01152015/Files/Functions/09282015_plot_spanning_tree_mod.R")
source("/Volumes/guacamole/Software/Final Scripts for Paper _ 01152015/Files/Functions/09282015_plot_genes_in_pseudotime_mod.txt")
#Loading all high quality cells and filtering for lowly expressed genes and cell cycle genes
setwd("/Volumes/guacamole/Software/Final Scripts for Paper _ 01152015/Files")
allcounts_allcells<-read.table("AllCounts_specPops_read_gene_ERCC_filt_FINAL.txt")
setwd("/Volumes/guacamole/Software/Final Scripts for Paper _ 01152015/Files")
oligos<-as.vector(read.table("STAR_oligos_updated_09232015.txt")[,1])
allcounts_allcells_nooligo<-allcounts_allcells[,-na.omit(match(oligos,colnames(allcounts_allcells)))]
allcounts_allcells_nooligo_noast<-allcounts_allcells_nooligo[,!grepl("Ast",colnames(allcounts_allcells_nooligo))]
#Filtering for expressed by 5 cells at 10 counts
greaterthan0<-allcounts_allcells_nooligo_noast>10
greaterthan0sum<-rowSums(greaterthan0)
allcounts_allcells_nooligo_noast_genefilt<-allcounts_allcells_nooligo_noast[greaterthan0sum>=5,]
gfp_mapped<-read.table("Allcounts_GFP_mapped.txt")
gfp_mapped_nooligo<-gfp_mapped[,match(colnames(allcounts_allcells_nooligo_noast),colnames(gfp_mapped))]
gfp_mapped_nooligo_noERCC<-gfp_mapped_nooligo[!grepl("ERCC",rownames(gfp_mapped_nooligo)),]
greaterthan0<-gfp_mapped_nooligo_noERCC>10
greaterthan0sum<-rowSums(greaterthan0)
gfp_mapped_nooligo_noERCC_genefilt<-gfp_mapped_nooligo_noERCC[greaterthan0sum>=5,]
glm <- DGEList(counts=gfp_mapped_nooligo_noERCC_genefilt)
glm.norm <- calcNormFactors(glm,method="TMM")
load("/Volumes/guacamole/Software/Final Scripts for Paper _ 01152015/Files/Katja_exonic_gene_sizes_ERCC92.RData")
names(exonic.gene.sizes) <- tolower(names(exonic.gene.sizes))
exonic.gene.sizes.2<-c(exonic.gene.sizes,720)
names(exonic.gene.sizes.2)<-c(names(exonic.gene.sizes),'gfp')
ind <- match(tolower(rownames(glm.norm)), names(exonic.gene.sizes.2))
exonic.gene.sizes.ord <- exonic.gene.sizes.2[ind]
genes <- data.frame(gene.symbol=rownames(glm.norm),
exonic.size=exonic.gene.sizes.ord)
fpkm_glm_genefilt_nooligo_gfp <- rpkm(glm.norm, gene.length=genes$exonic.size,
normalized.lib.sizes=T, log=F)
setwd("/Volumes/guacamole/Software/Final Scripts for Paper _ 01152015/Files/Ordering")
group1<-as.vector(read.table("group1_10282015_50minModels_quiescent1_consensus_2.txt")[,1])
group2<-as.vector(read.table("group2_10282015_50minModels_active_nondividing_consensus_2.txt")[,1])
group3<-as.vector(read.table("group3_10282015_50minModels_active_dividing_early_consensus_2.txt")[,1])
group4<-as.vector(read.table("group4_10282015_50minModels_active_dividing_late_consensus_2.txt")[,1])
group5<-as.vector(read.table("group5_10282015_50minModels_active_dividing_consensus_2.txt")[,1])
group1_fpkm<-fpkm_glm_genefilt_nooligo_gfp[,match(group1,colnames(fpkm_glm_genefilt_nooligo_gfp))]
group2_fpkm<-fpkm_glm_genefilt_nooligo_gfp[,match(group2,colnames(fpkm_glm_genefilt_nooligo_gfp))]
group3_fpkm<-fpkm_glm_genefilt_nooligo_gfp[,match(group3,colnames(fpkm_glm_genefilt_nooligo_gfp))]
group4_fpkm<-fpkm_glm_genefilt_nooligo_gfp[,match(group4,colnames(fpkm_glm_genefilt_nooligo_gfp))]
group5_fpkm<-fpkm_glm_genefilt_nooligo_gfp[,match(group5,colnames(fpkm_glm_genefilt_nooligo_gfp))]
comb_fpkm<-cbind(group1_fpkm,group2_fpkm,group3_fpkm,group4_fpkm,group5_fpkm)
#c("#9966FF","#c9cc00","#ff9933","#ff3333","#00CCFF")
comb_fpkm_col<-vector(length=length(comb_fpkm[1,]),mode="character")
comb_fpkm_col[match(group1,colnames(comb_fpkm))]<-"#9966FF"
comb_fpkm_col[match(group2,colnames(comb_fpkm))]<-"#c9cc00"
comb_fpkm_col[match(group3,colnames(comb_fpkm))]<-"#ff9933"
comb_fpkm_col[match(group4,colnames(comb_fpkm))]<-"#ff3333"
comb_fpkm_col[match(group5,colnames(comb_fpkm))]<-"#00CCFF"
comb_fac_col<-vector(length=length(comb_fpkm[1,]),mode="character")
comb_fac_col[match(group1,colnames(comb_fpkm))]<-"qNSC-like"
comb_fac_col[match(group2,colnames(comb_fpkm))]<-"aNSC-early"
comb_fac_col[match(group3,colnames(comb_fpkm))]<-"aNSC-mid"
comb_fac_col[match(group4,colnames(comb_fpkm))]<-"aNSC-late"
comb_fac_col[match(group5,colnames(comb_fpkm))]<-"NPC-like"
#Larger plots used for Figure 4E, 4F
setwd("/Volumes/guacamole/Software/Final Scripts for Paper _ 01152015/GFP_mapping")
int_genes<-c("Dlx2","Dlx1","Jag1","Notch2","Atp1a2","Ntsr2","Gja1","Ascl1","Cdk1","Notch2","Notch1","Dcx","Tubb3","Lgr4","Serpine2","Fgfr3","Fgfr2","Dlx6as1","Egfr","GFP")
for(i in 1:length(int_genes)){
int_fpkm_glm<-comb_fpkm[match(int_genes,rownames(comb_fpkm)),]
dataframe<-data.frame(data=log2(int_fpkm_glm[i,]+1),col=comb_fpkm_col,fac=comb_fac_col)
dataframe$col<-as.character(dataframe$col)
dataframe$col <- factor(dataframe$col, levels=unique(dataframe$col), ordered = T)
dataframe$fac<-as.character(dataframe$fac)
dataframe$fac <- factor(dataframe$fac, levels=unique(dataframe$fac), ordered = T)
p<-ggplot(dataframe)
p<-p+geom_violin(aes(x=dataframe$fac,y=dataframe$data,fill=dataframe$col),trim=F,scale="width",alpha=0.5,width=0.5)+geom_jitter(aes(x=dataframe$fac,y=dataframe$data),position = position_jitter(width = .3))
p<-p+theme_classic()
p<-p + theme(legend.position="none")
p<-p+scale_x_discrete(labels=c("qNSC-\nlike","aNSC-\nearly","aNSC-\nmid","aNSC-\nlate","NPC-\nlike"))
p<-p+theme(axis.text.y=element_text(size=15))
p<-p+theme(axis.text.x=element_text(size=20))
p<-p+theme(axis.title=element_text(size=20))
p<-p+theme(axis.title.y=element_text(vjust=1))
p<-p+theme(axis.title.x=element_text(vjust=-0.10))
p<-p+labs(y="log2(FPKM+1)")
p<-p+theme(axis.title.x=element_blank())
p<-p+scale_fill_manual(values=c("#9966FF","#c9cc00","#ff9933","#ff3333","#00CCFF"))
pdf(paste(rownames(int_fpkm_glm)[i],"_gfp_mapping.pdf",sep=""),width=10,height=4)
print(p)
dev.off()
}
#==========================================================================================================
setwd("/Volumes/guacamole/Software/Final Scripts for Paper _ 01152015/Files/Ordering")
group1<-as.vector(read.table("group1_10282015_50minModels_quiescent1_consensus_2.txt")[,1])
group2<-as.vector(read.table("group2_10282015_50minModels_active_nondividing_consensus_2.txt")[,1])
group3<-as.vector(read.table("group3_10282015_50minModels_active_dividing_early_consensus_2.txt")[,1])
group4<-as.vector(read.table("group4_10282015_50minModels_active_dividing_late_consensus_2.txt")[,1])
group5<-as.vector(read.table("group5_10282015_50minModels_active_dividing_consensus_2.txt")[,1])
group1_fpkm<-fpkm_glm_genefilt_nooligo_gfp[,match(group1,colnames(fpkm_glm_genefilt_nooligo_gfp))]
group2_fpkm<-fpkm_glm_genefilt_nooligo_gfp[,match(group2,colnames(fpkm_glm_genefilt_nooligo_gfp))]
group3_fpkm<-fpkm_glm_genefilt_nooligo_gfp[,match(group3,colnames(fpkm_glm_genefilt_nooligo_gfp))]
group4_fpkm<-fpkm_glm_genefilt_nooligo_gfp[,match(group4,colnames(fpkm_glm_genefilt_nooligo_gfp))]
group5_fpkm<-fpkm_glm_genefilt_nooligo_gfp[,match(group5,colnames(fpkm_glm_genefilt_nooligo_gfp))]
comb_fpkm<-cbind(group3_fpkm,group4_fpkm)
#c("#9966FF","#c9cc00","#ff9933","#ff3333","#00CCFF")
comb_fpkm_col<-vector(length=length(comb_fpkm[1,]),mode="character")
comb_fpkm_col[match(group1,colnames(comb_fpkm))]<-"#9966FF"
comb_fpkm_col[match(group2,colnames(comb_fpkm))]<-"#c9cc00"
comb_fpkm_col[match(group3,colnames(comb_fpkm))]<-"#ff9933"
comb_fpkm_col[match(group4,colnames(comb_fpkm))]<-"#ff3333"
comb_fpkm_col[match(group5,colnames(comb_fpkm))]<-"#00CCFF"
comb_fac_col<-vector(length=length(comb_fpkm[1,]),mode="character")
comb_fac_col[match(group1,colnames(comb_fpkm))]<-"qNSC-like"
comb_fac_col[match(group2,colnames(comb_fpkm))]<-"aNSC-early"
comb_fac_col[match(group3,colnames(comb_fpkm))]<-"aNSC-mid"
comb_fac_col[match(group4,colnames(comb_fpkm))]<-"aNSC-late"
comb_fac_col[match(group5,colnames(comb_fpkm))]<-"NPC-like"
#Larger plots used for Figure 4E, 4F
setwd("/Volumes/guacamole/Software/Final Scripts for Paper _ 01152015/GFP_mapping")
int_genes<-c("Dlx2","Dlx1","Jag1","Notch2","Atp1a2","Ntsr2","Gja1","Ascl1","Cdk1","Notch2","Notch1","Dcx","Tubb3","Lgr4","Serpine2","Fgfr3","Fgfr2","Dlx6as1","Egfr","GFP")
for(i in 1:length(int_genes)){
int_fpkm_glm<-comb_fpkm[match(int_genes,rownames(comb_fpkm)),]
dataframe<-data.frame(data=log2(int_fpkm_glm[i,]+1),col=comb_fpkm_col,fac=comb_fac_col)
dataframe$col<-as.character(dataframe$col)
dataframe$col <- factor(dataframe$col, levels=unique(dataframe$col), ordered = T)
dataframe$fac<-as.character(dataframe$fac)
dataframe$fac <- factor(dataframe$fac, levels=unique(dataframe$fac), ordered = T)
p<-ggplot(dataframe)
p<-p+geom_violin(aes(x=dataframe$fac,y=dataframe$data,fill=dataframe$col),trim=F,scale="width",alpha=0.5,width=0.5)+geom_jitter(aes(x=dataframe$fac,y=dataframe$data),position = position_jitter(width = .3))
p<-p+theme_classic()
p<-p + theme(legend.position="none")
p<-p+scale_x_discrete(labels=c("aNSC-\nmid","aNSC-\nlate"))
p<-p+theme(axis.text.y=element_text(size=15))
p<-p+theme(axis.text.x=element_text(size=20))
p<-p+theme(axis.title=element_text(size=20))
p<-p+theme(axis.title.y=element_text(vjust=1))
p<-p+theme(axis.title.x=element_text(vjust=-0.10))
p<-p+labs(y="log2(FPKM+1)")
p<-p+theme(axis.title.x=element_blank())
p<-p+scale_fill_manual(values=c("#ff9933","#ff3333"))
pdf(paste(rownames(int_fpkm_glm)[i],"_gfp_mapping_group3_group4_only.pdf",sep=""),width=6,height=4)
print(p)
dev.off()
}
