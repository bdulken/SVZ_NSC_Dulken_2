install.packages("doMC", dep=T)
install.packages("caTools", dep=T)
install.packages("utils", dep=T)
install.packages("utils", dep = T)
source("http://bioconductor.org/biocLite.R")
biocLite("scde")
?scde.error.models
library(scde)
library("scde")
biocLite('flemix')
install.packages("Downloads/scde_1.2.1.tar.gz")
install.packages("/Downloads/scde_1.2.1.tar.gz",repos = NULL, type = "source")
install.packages("Downloads/scde_1.2.1.tar.gz",repos = NULL, type = "source")
library(cellrangerRkit)
setwd("/Volumes/guacamole/Software/Final Scripts for Paper _ 01152015/Figure2_Output/Ki67_analysis/")
#Ki67 levels
rm(list=ls())
library(ggplot2)
setwd("/Volumes/guacamole/Software/Final Scripts for Paper _ 01152015/Figure2_Output/Ki67_analysis/")
ki67<-read.table("Ki67Levels.txt",header=T)
Ast_mean<-mean(as.numeric(ki67[2,]))
qNSC_mean<-mean(as.numeric(ki67[4,]))
aNSC_mean<-mean(as.numeric(ki67[6,]))
NPC_mean<-mean(as.numeric(ki67[8,]))
Ast_sd<-sd(as.numeric(ki67[2,]))
qNSC_sd<-sd(as.numeric(ki67[4,]))
aNSC_sd<-sd(as.numeric(ki67[6,]))
NPC_sd<-sd(as.numeric(ki67[8,]))
ki67mean<-c(Ast_mean,
qNSC_mean,
aNSC_mean,
NPC_mean)
sd<-c(Ast_sd,
qNSC_sd,
aNSC_sd,
NPC_sd)
upper<-ki67mean+sd
lower<-ki67mean-sd
top<-100-ki67mean
wilcox.test(as.numeric(ki67[6,]),as.numeric(ki67[8,]))
data<-data.frame(names=c("Astrocytes","qNSCs","aNSCs","NPCs"),ki67mean,top)
groups_melt<-melt(data)
groups_melt<-data.frame(groups_melt,upper=c(upper,upper),lower=c(lower,lower))
p<-ggplot(groups_melt)
p<-p+geom_bar(aes(x=factor(groups_melt$names,levels=c("Astrocytes","qNSCs","aNSCs","NPCs"),ordered=T),
y=as.numeric(groups_melt$value),fill=groups_melt$variable),stat="identity",width=0.6)
# p<p+geom_errorbar(aes(x=factor(groups_melt$names,levels=c("Astrocytes","qNSCs","aNSCs","NPCs"),ordered=T),
#                       ymax=as.numeric(groups_melt$upper),ymin=as.numeric(groups_melt$lower)),stat="identity",width=0.6)
p<-p+labs(x="Cell type",y="Percent")
p<-p+theme_classic() + theme(
axis.line.x = element_line(colour = 'black', size=0.5, linetype='solid'),
axis.line.y = element_line(colour = 'black', size=0.5, linetype='solid'))
p<-p+theme(legend.position="none")
p<-p+theme(axis.text.x=element_text(size=22))
p<-p+theme(axis.title.x=element_text(size=26))
p<-p+theme(axis.text.y=element_text(size=22))
p<-p+theme(axis.title.y=element_text(size=26))
p<-p+theme(plot.title=element_text(size=22))
p<-p+scale_fill_manual(values=c("#9966FF","#ff3333","#00CCFF"))
p<-p+theme(axis.title.y=element_text(vjust=1))
p<-p+theme(axis.title.x=element_text(vjust=-0.10))
p
pdf("Ki67Values.pdf")
print(p)
dev.off()
setwd("/Volumes/guacamole/Software/Final Scripts for Paper _ 01152015/Figure2_Output/Ki67_analysis/")
ki67_neg<-c(as.numeric(ki67[6,]),as.numeric(ki67[8,]))
ki67_neg_fac<-c(rep("aNSC",4),rep("NPC",4))
d<-data.frame(neg=ki67_neg,fac=ki67_neg_fac)
p<-ggplot(d)
p<-p+geom_boxplot(aes(x=d$fac,y=d$neg),fill=c("#FF3300","#00CCFF"))
# p<p+geom_errorbar(aes(x=factor(groups_melt$names,levels=c("Astrocytes","qNSCs","aNSCs","NPCs"),ordered=T),
#                       ymax=as.numeric(groups_melt$upper),ymin=as.numeric(groups_melt$lower)),stat="identity",width=0.6)
p<-p+labs(x="Cell type",y="Percent Ki67 negative")
p<-p+theme_classic() + theme(
axis.line.x = element_line(colour = 'black', size=0.5, linetype='solid'),
axis.line.y = element_line(colour = 'black', size=0.5, linetype='solid'))
p<-p+theme(legend.position="none")
p<-p+theme(axis.text.x=element_text(size=22))
p<-p+theme(axis.title.x=element_text(size=26))
p<-p+theme(axis.text.y=element_text(size=22))
p<-p+theme(axis.title.y=element_text(size=26))
p<-p+theme(plot.title=element_text(size=22))
p<-p+scale_fill_manual(values=c("#FF3300","#00CCFF"))
p<-p+theme(axis.title.y=element_text(vjust=1))
p<-p+theme(axis.title.x=element_text(vjust=-0.10))
p
pdf("Ki67Values_aNSC_NPC_only.pdf")
print(p)
dev.off()
#Ki67 levels
rm(list=ls())
library(ggplot2)
setwd("/Volumes/guacamole/Software/Final Scripts for Paper _ 01152015/Figure2_Output/Ki67_analysis/")
ki67<-read.table("Ki67Levels_ANSC_NPC.txt",header=T)
aNSC_mean<-mean(as.numeric(ki67[2,]))
NPC_mean<-mean(as.numeric(ki67[4,]))
aNSC_sd<-sd(as.numeric(ki67[2,]))
NPC_sd<-sd(as.numeric(ki67[4,]))
ki67mean<-c(aNSC_mean,
NPC_mean)
sd<-c(ANSC_sd,
NPC_sd)
upper<-ki67mean+sd
lower<-ki67mean-sd
top<-100-ki67mean
wilcox.test(as.numeric(ki67[2,]),as.numeric(ki67[4,]))
setwd("/Volumes/guacamole/Software/Final Scripts for Paper _ 01152015/Figure2_Output/Ki67_analysis/")
ki67_neg<-c(as.numeric(ki67[2,]),as.numeric(ki67[4,]))
ki67_neg_fac<-c(rep("aNSC",6),rep("NPC",6))
d<-data.frame(neg=ki67_neg,fac=ki67_neg_fac)
p<-ggplot(d)
p<-p+geom_boxplot(aes(x=d$fac,y=d$neg),fill=c("#FF3300","#00CCFF"))
# p<p+geom_errorbar(aes(x=factor(groups_melt$names,levels=c("Astrocytes","qNSCs","aNSCs","NPCs"),ordered=T),
#                       ymax=as.numeric(groups_melt$upper),ymin=as.numeric(groups_melt$lower)),stat="identity",width=0.6)
p<-p+labs(x="Cell type",y="Percent Ki67 negative")
p<-p+theme_classic() + theme(
axis.line.x = element_line(colour = 'black', size=0.5, linetype='solid'),
axis.line.y = element_line(colour = 'black', size=0.5, linetype='solid'))
p<-p+theme(legend.position="none")
p<-p+theme(axis.text.x=element_text(size=22))
p<-p+theme(axis.title.x=element_text(size=26))
p<-p+theme(axis.text.y=element_text(size=22))
p<-p+theme(axis.title.y=element_text(size=26))
p<-p+theme(plot.title=element_text(size=22))
p<-p+scale_fill_manual(values=c("#FF3300","#00CCFF"))
p<-p+theme(axis.title.y=element_text(vjust=1))
p<-p+theme(axis.title.x=element_text(vjust=-0.10))
p
pdf("Ki67Values_aNSC_NPC_only_extrareps.pdf")
print(p)
dev.off()
#Ki67 levels
rm(list=ls())
library(ggplot2)
setwd("/Volumes/guacamole/Software/Final Scripts for Paper _ 01152015/Figure2_Output/Ki67_analysis/")
ki67<-read.table("Ki67Levels_ANSC_NPC.txt",header=T)
aNSC_mean<-mean(as.numeric(ki67[2,]))
NPC_mean<-mean(as.numeric(ki67[4,]))
aNSC_sd<-sd(as.numeric(ki67[2,]))
NPC_sd<-sd(as.numeric(ki67[4,]))
ki67mean<-c(aNSC_mean,
NPC_mean)
sd<-c(ANSC_sd,
NPC_sd)
upper<-ki67mean+sd
lower<-ki67mean-sd
top<-100-ki67mean
wilcox.test(as.numeric(ki67[2,]),as.numeric(ki67[4,]))
setwd("/Volumes/guacamole/Software/Final Scripts for Paper _ 01152015/Figure2_Output/Ki67_analysis/")
ki67_neg<-c(as.numeric(ki67[2,]),as.numeric(ki67[4,]))
ki67_neg_fac<-c(rep("aNSC",6),rep("NPC",6))
d<-data.frame(neg=ki67_neg,fac=ki67_neg_fac)
p<-ggplot(d)
p<-p+geom_boxplot(aes(x=d$fac,y=d$neg),fill=c("#FF3300","#00CCFF"))
# p<p+geom_errorbar(aes(x=factor(groups_melt$names,levels=c("Astrocytes","qNSCs","aNSCs","NPCs"),ordered=T),
#                       ymax=as.numeric(groups_melt$upper),ymin=as.numeric(groups_melt$lower)),stat="identity",width=0.6)
p<-p+labs(x="Cell type",y="Percent Ki67 negative")
p<-p+theme_classic() + theme(
axis.line.x = element_line(colour = 'black', size=0.5, linetype='solid'),
axis.line.y = element_line(colour = 'black', size=0.5, linetype='solid'))
p<-p+theme(legend.position="none")
p<-p+theme(axis.text.x=element_text(size=22))
p<-p+theme(axis.title.x=element_text(size=26))
p<-p+theme(axis.text.y=element_text(size=22))
p<-p+theme(axis.title.y=element_text(size=26))
p<-p+theme(plot.title=element_text(size=22))
p<-p+scale_fill_manual(values=c("#FF3300","#00CCFF"))
p<-p+theme(axis.title.y=element_text(vjust=1))
p<-p+theme(axis.title.x=element_text(vjust=-0.10))
p
pdf("Ki67Values_aNSC_NPC_only_extrareps.pdf")
print(p)
dev.off()
#Ben Dulken
#4/26/16
#This script performs plotting and statistical testing for the experiments relating to validating
#the finding that the aNSC gate contains multiple populations.
#Multiple groups of aNSCs (GFAP-high, GFAP-mid, GFAP-low) were sorted along with NPCs
#qPCRs were performed on genes of interest.
#============================================================================================================================================#
#Plots box/dot plots for specific genes
#Figure 4B, S4B
rm(list=ls())
library(ggplot2)
setwd("/Volumes/guacamole/Software/Final Scripts for Paper _ 01152015/Files")
expression<-read.table("allSorts_average.txt")
expression_compressed<-aggregate(t(as.matrix(expression)),list(c(rep(c("aNSC_early_1","aNSC_mid_1","aNSC-late_1","NPC_1"),4))),mean)
factor<-factor(c(rep(c("GFAP-high\naNSC","GFAP-mid\naNSC","GFAP-low\naNSC","NPC"),4)))
color<-factor(c(rep(c("#FFFFFF","#FFFFFF","#ff3333","#00CCFF"),4)))
exp_color<-factor(c(rep("#000000",16)))
setwd("/Volumes/guacamole/Software/Final Scripts for Paper _ 01152015/Figure4_Output")
for(i in 1:length(expression[,1])){
expression_expanded<-c(rep(expression_compressed[,i+1],4))
data<-data.frame(t(expression[i,]),expression_expanded,factor=factor,color=color)
data$factor<-as.character(data$factor)
data$factor <- factor(data$factor, levels=unique(data$factor), ordered = T)
data$color<-as.character(data$color)
data$color <- factor(data$color, levels=unique(data$color), ordered = T)
p<-ggplot(data)
p<-p+geom_boxplot(aes(x=factor,y=data[,1], fill=color))
p<-p+geom_point(aes(x=factor,y=data[,1]),color=exp_color,size=5,alpha=0.7)
p<-p+geom_line(aes(x=factor,y=data[,2],group=exp_color,color=exp_color),size=1.5)
p<-p+theme_classic() + theme(
axis.line.x = element_line(colour = 'black', size=0.5, linetype='solid'),
axis.line.y = element_line(colour = 'black', size=0.5, linetype='solid'))
p<-p+labs(y="Gene expression\n(normalized to B-Actin)")
p<-p+theme(legend.position = "none")
p<-p+theme(axis.text.x=element_text(size=18))
p<-p+theme(axis.title.x=element_blank())
p<-p+theme(axis.text.y=element_text(size=22))
p<-p+theme(axis.title.y=element_text(size=20))
p<-p+theme(plot.title=element_text(size=22))
p<-p+theme(axis.title.y=element_text(vjust=1))
p<-p+theme(axis.title.x=element_text(vjust=-0.10))
p<-p+scale_fill_manual(values=c("#FFFFFF","#ff3333","#00CCFF"))
p<-p+scale_color_manual(values=c("#000000"))
pdf(paste(colnames(data)[1],"_allsorts_average.pdf",sep=""),width=8,height=4)
print(p)
dev.off()
}
#============================================================================================================================================#
#Statistical testing
ttest_results<-c()
for(i in 1:length(expression[,1])){
curr<-expression[i,]
ttest1<-wilcox.test(as.numeric(curr[c(1,5,9,13)]),as.numeric(curr[c(2,6,10,14)]),alternative="less")
ttest2<-wilcox.test(as.numeric(curr[c(1,5,9,13,2,6,10,14)]),as.numeric(curr[c(3,7,11,15)]),alternative="less")
ttest3<-wilcox.test(as.numeric(curr[c(3,7,11,15)]),as.numeric(curr[c(4,8,12,16)]),alternative="less")
ttest_results<-rbind(ttest_results,c(ttest1$p.value,ttest2$p.value,ttest3$p.value))
}
ttest_results
ttest_results<-c()
for(i in 1:length(expression[,1])){
curr<-expression[i,]
ttest1<-wilcox.test(as.numeric(curr[c(1,5,9,13)]),as.numeric(curr[c(2,6,10,14)]),alternative="greater")
ttest2<-wilcox.test(as.numeric(curr[c(1,5,9,13,2,6,10,14)]),as.numeric(curr[c(3,7,11,15)]),alternative="greater")
ttest3<-wilcox.test(as.numeric(curr[c(3,7,11,15)]),as.numeric(curr[c(4,8,12,16)]),alternative="greater")
ttest_results<-rbind(ttest_results,c(ttest1$p.value,ttest2$p.value,ttest3$p.value))
}
ttest_results
rownames(expression)
#============================================================================================================================================#
#============================================================================================================================================#
#PCA analysis with NS projection
#Reading in NS and specific population cells
rm(list=ls())
library(ggplot2)
library(edgeR)
#Loading all high quality cells and filtering for lowly expressed genes and cell cycle genes
setwd("/Volumes/guacamole/Software/Final Scripts for Paper _ 01152015/Files")
allcounts_allcells<-read.table("AllCounts_specPops_read_gene_ERCC_filt_FINAL.txt")
setwd("/Volumes/guacamole/Software/Final Scripts for Paper _ 01152015/Files")
oligos<-as.vector(read.table("STAR_oligos_updated_09232015.txt")[,1])
allcounts_allcells_nooligo<-allcounts_allcells[,-na.omit(match(oligos,colnames(allcounts_allcells)))]
#Filtering for expressed by 5 cells at 10 counts
greaterthan0<-allcounts_allcells_nooligo>10
greaterthan0sum<-rowSums(greaterthan0)
allcounts_allcells_nooligo_genefilt<-allcounts_allcells_nooligo[greaterthan0sum>=5,]
glm <- DGEList(counts=allcounts_allcells_nooligo_genefilt)
glm.norm <- calcNormFactors(glm,method="TMM")
load("/Volumes/guacamole/Software/Final Scripts for Paper _ 01152015/Files/Katja_exonic_gene_sizes_ERCC92.RData")
names(exonic.gene.sizes) <- tolower(names(exonic.gene.sizes))
ind <- match(tolower(rownames(glm.norm)), names(exonic.gene.sizes))
exonic.gene.sizes.ord <- exonic.gene.sizes[ind]
genes <- data.frame(gene.symbol=rownames(glm.norm),
exonic.size=exonic.gene.sizes.ord)
fpkm_glm_genefilt_nooligo <- rpkm(glm.norm, gene.length=genes$exonic.size,
normalized.lib.sizes=T, log=F)
setwd("/Volumes/guacamole/Software/Final Scripts for Paper _ 01152015/Files/Ordering")
group1<-as.vector(read.table("group1_10282015_50minModels_quiescent1_consensus_2.txt")[,1])
group2<-as.vector(read.table("group2_10282015_50minModels_active_nondividing_consensus_2.txt")[,1])
group3<-as.vector(read.table("group3_10282015_50minModels_active_dividing_early_consensus_2.txt")[,1])
group4<-as.vector(read.table("group4_10282015_50minModels_active_dividing_late_consensus_2.txt")[,1])
group5<-as.vector(read.table("group5_10282015_50minModels_active_dividing_consensus_2.txt")[,1])
group1_fpkm<-fpkm_glm_genefilt_nooligo[,match(group1,colnames(fpkm_glm_genefilt_nooligo))]
group2_fpkm<-fpkm_glm_genefilt_nooligo[,match(group2,colnames(fpkm_glm_genefilt_nooligo))]
group3_fpkm<-fpkm_glm_genefilt_nooligo[,match(group3,colnames(fpkm_glm_genefilt_nooligo))]
group4_fpkm<-fpkm_glm_genefilt_nooligo[,match(group4,colnames(fpkm_glm_genefilt_nooligo))]
group5_fpkm<-fpkm_glm_genefilt_nooligo[,match(group5,colnames(fpkm_glm_genefilt_nooligo))]
comb_fpkm<-cbind(group2_fpkm,group3_fpkm,group4_fpkm,group5_fpkm)
#c("#9966FF","#c9cc00","#ff9933","#ff3333","#00CCFF")
comb_fpkm_col<-vector(length=length(comb_fpkm[1,]),mode="character")
comb_fpkm_col[match(group1,colnames(comb_fpkm))]<-"#9966FF"
comb_fpkm_col[match(group2,colnames(comb_fpkm))]<-"#c9cc00"
comb_fpkm_col[match(group3,colnames(comb_fpkm))]<-"#ff9933"
comb_fpkm_col[match(group4,colnames(comb_fpkm))]<-"#ff3333"
comb_fpkm_col[match(group5,colnames(comb_fpkm))]<-"#00CCFF"
comb_fac_col<-vector(length=length(comb_fpkm[1,]),mode="character")
comb_fac_col[match(group1,colnames(comb_fpkm))]<-"qNSC-like"
comb_fac_col[match(group2,colnames(comb_fpkm))]<-"aNSC-early"
comb_fac_col[match(group3,colnames(comb_fpkm))]<-"aNSC-mid"
comb_fac_col[match(group4,colnames(comb_fpkm))]<-"aNSC-late"
comb_fac_col[match(group5,colnames(comb_fpkm))]<-"NPC-like"
#Larger plots used for Figure 5D
setwd("/Volumes/guacamole/Software/Final Scripts for Paper _ 01152015/Figure4_Output")
int_genes<-c("Dlx2","Dlx1","Atp1a2","Ntsr2","Gja1","Ascl1","Cdk1","Mki67","Ccna2","Ccnb1","Prc1","Hmgb2","Dcx","Fgfr3","Dlx6as1","Egfr","Nrxn3")
for(i in 1:length(int_genes)){
int_fpkm_glm<-comb_fpkm[match(int_genes,rownames(comb_fpkm)),]
#comb_fpkm_col<-c("#009900","#3366FF","#990000","#CC6600","#FF0066","#000000")
dataframe<-data.frame(data=log2(int_fpkm_glm[i,]+1),col=comb_fpkm_col,fac=comb_fac_col)
dataframe$col<-as.character(dataframe$col)
dataframe$col <- factor(dataframe$col, levels=unique(dataframe$col), ordered = T)
dataframe$fac<-as.character(dataframe$fac)
dataframe$fac <- factor(dataframe$fac, levels=unique(dataframe$fac), ordered = T)
p<-ggplot(dataframe)
p<-p+geom_violin(aes(x=dataframe$fac,y=dataframe$data,fill=dataframe$col),trim=F,scale="area",alpha=0.5,width=0.5)+
geom_jitter(aes(x=dataframe$fac,y=dataframe$data),position = position_jitter(width = .3),alpha=0.7)
p<-p+theme_classic() + theme(
axis.line.x = element_line(colour = 'black', size=0.5, linetype='solid'),
axis.line.y = element_line(colour = 'black', size=0.5, linetype='solid'))
p<-p + theme(legend.position="none")
p<-p+scale_x_discrete(labels=c("aNSC-\nearly","aNSC-\nmid","aNSC-\nlate","NPC-\nlike"))
p<-p+theme(axis.text.y=element_text(size=15))
p<-p+theme(axis.text.x=element_text(size=20))
p<-p+theme(axis.title=element_text(size=20))
p<-p+theme(axis.title.y=element_text(vjust=1))
p<-p+theme(axis.title.x=element_text(vjust=-0.10))
p<-p+labs(y="log2(FPKM+1)")
p<-p+theme(axis.title.x=element_blank())
p<-p+scale_fill_manual(values=c("#c9cc00","#ff9933","#ff3333","#00CCFF"))
pdf(paste(rownames(int_fpkm_glm)[i],"_expression_violin_forGFAPgradientcomparison.pdf",sep=""),width=6,height=3)
print(p)
dev.off()
}
#============================================================================================================================================#
#============================================================================================================================================#
#PCA analysis with NS projection
#Reading in NS and specific population cells
rm(list=ls())
library(ggplot2)
library(edgeR)
#Loading all high quality cells and filtering for lowly expressed genes and cell cycle genes
setwd("/Volumes/guacamole/Software/Final Scripts for Paper _ 01152015/Files")
allcounts_allcells<-read.table("AllCounts_specPops_read_gene_ERCC_filt_FINAL.txt")
setwd("/Volumes/guacamole/Software/Final Scripts for Paper _ 01152015/Files")
oligos<-as.vector(read.table("STAR_oligos_updated_09232015.txt")[,1])
allcounts_allcells_nooligo<-allcounts_allcells[,-na.omit(match(oligos,colnames(allcounts_allcells)))]
#Filtering for expressed by 5 cells at 10 counts
greaterthan0<-allcounts_allcells_nooligo>10
greaterthan0sum<-rowSums(greaterthan0)
allcounts_allcells_nooligo_genefilt<-allcounts_allcells_nooligo[greaterthan0sum>=5,]
glm <- DGEList(counts=allcounts_allcells_nooligo_genefilt)
glm.norm <- calcNormFactors(glm,method="TMM")
load("/Volumes/guacamole/Software/Final Scripts for Paper _ 01152015/Files/Katja_exonic_gene_sizes_ERCC92.RData")
names(exonic.gene.sizes) <- tolower(names(exonic.gene.sizes))
ind <- match(tolower(rownames(glm.norm)), names(exonic.gene.sizes))
exonic.gene.sizes.ord <- exonic.gene.sizes[ind]
genes <- data.frame(gene.symbol=rownames(glm.norm),
exonic.size=exonic.gene.sizes.ord)
fpkm_glm_genefilt_nooligo <- rpkm(glm.norm, gene.length=genes$exonic.size,
normalized.lib.sizes=T, log=F)
setwd("/Volumes/guacamole/Software/Final Scripts for Paper _ 01152015/Files/Ordering")
group1<-as.vector(read.table("group1_10282015_50minModels_quiescent1_consensus_2.txt")[,1])
group2<-as.vector(read.table("group2_10282015_50minModels_active_nondividing_consensus_2.txt")[,1])
group3<-as.vector(read.table("group3_10282015_50minModels_active_dividing_early_consensus_2.txt")[,1])
group4<-as.vector(read.table("group4_10282015_50minModels_active_dividing_late_consensus_2.txt")[,1])
group5<-as.vector(read.table("group5_10282015_50minModels_active_dividing_consensus_2.txt")[,1])
group1_fpkm<-fpkm_glm_genefilt_nooligo[,match(group1,colnames(fpkm_glm_genefilt_nooligo))]
group2_fpkm<-fpkm_glm_genefilt_nooligo[,match(group2,colnames(fpkm_glm_genefilt_nooligo))]
group3_fpkm<-fpkm_glm_genefilt_nooligo[,match(group3,colnames(fpkm_glm_genefilt_nooligo))]
group4_fpkm<-fpkm_glm_genefilt_nooligo[,match(group4,colnames(fpkm_glm_genefilt_nooligo))]
group5_fpkm<-fpkm_glm_genefilt_nooligo[,match(group5,colnames(fpkm_glm_genefilt_nooligo))]
comb_fpkm<-cbind(group2_fpkm,group3_fpkm,group4_fpkm,group5_fpkm)
#c("#9966FF","#c9cc00","#ff9933","#ff3333","#00CCFF")
comb_fpkm_col<-vector(length=length(comb_fpkm[1,]),mode="character")
comb_fpkm_col[match(group1,colnames(comb_fpkm))]<-"#9966FF"
comb_fpkm_col[match(group2,colnames(comb_fpkm))]<-"#c9cc00"
comb_fpkm_col[match(group3,colnames(comb_fpkm))]<-"#ff9933"
comb_fpkm_col[match(group4,colnames(comb_fpkm))]<-"#ff3333"
comb_fpkm_col[match(group5,colnames(comb_fpkm))]<-"#00CCFF"
comb_fac_col<-vector(length=length(comb_fpkm[1,]),mode="character")
comb_fac_col[match(group1,colnames(comb_fpkm))]<-"qNSC-like"
comb_fac_col[match(group2,colnames(comb_fpkm))]<-"aNSC-early"
comb_fac_col[match(group3,colnames(comb_fpkm))]<-"aNSC-mid"
comb_fac_col[match(group4,colnames(comb_fpkm))]<-"aNSC-late"
comb_fac_col[match(group5,colnames(comb_fpkm))]<-"NPC-like"
#Larger plots used for Figure 5D
setwd("/Volumes/guacamole/Software/Final Scripts for Paper _ 01152015/Figure4_Output")
int_genes<-c("Dlx2","Dlx1","Atp1a2","Ntsr2","Gja1","Ascl1","Cdk1","Mki67","Ccna2","Ccnb1","Prc1","Hmgb2","Dcx","Fgfr3","Dlx6as1","Egfr","Nrxn3")
for(i in 1:length(int_genes)){
int_fpkm_glm<-comb_fpkm[match(int_genes,rownames(comb_fpkm)),]
#comb_fpkm_col<-c("#009900","#3366FF","#990000","#CC6600","#FF0066","#000000")
dataframe<-data.frame(data=log2(int_fpkm_glm[i,]+1),col=comb_fpkm_col,fac=comb_fac_col)
dataframe$col<-as.character(dataframe$col)
dataframe$col <- factor(dataframe$col, levels=unique(dataframe$col), ordered = T)
dataframe$fac<-as.character(dataframe$fac)
dataframe$fac <- factor(dataframe$fac, levels=unique(dataframe$fac), ordered = T)
p<-ggplot(dataframe)
p<-p+geom_violin(aes(x=dataframe$fac,y=dataframe$data,fill=dataframe$col),trim=F,scale="count",alpha=0.5,width=0.5)+
geom_jitter(aes(x=dataframe$fac,y=dataframe$data),position = position_jitter(width = .3),alpha=0.7)
p<-p+theme_classic() + theme(
axis.line.x = element_line(colour = 'black', size=0.5, linetype='solid'),
axis.line.y = element_line(colour = 'black', size=0.5, linetype='solid'))
p<-p + theme(legend.position="none")
p<-p+scale_x_discrete(labels=c("aNSC-\nearly","aNSC-\nmid","aNSC-\nlate","NPC-\nlike"))
p<-p+theme(axis.text.y=element_text(size=15))
p<-p+theme(axis.text.x=element_text(size=20))
p<-p+theme(axis.title=element_text(size=20))
p<-p+theme(axis.title.y=element_text(vjust=1))
p<-p+theme(axis.title.x=element_text(vjust=-0.10))
p<-p+labs(y="log2(FPKM+1)")
p<-p+theme(axis.title.x=element_blank())
p<-p+scale_fill_manual(values=c("#c9cc00","#ff9933","#ff3333","#00CCFF"))
pdf(paste(rownames(int_fpkm_glm)[i],"_expression_violin_forGFAPgradientcomparison.pdf",sep=""),width=6,height=3)
print(p)
dev.off()
}
#============================================================================================================================================#
#============================================================================================================================================#
#PCA analysis with NS projection
#Reading in NS and specific population cells
rm(list=ls())
library(ggplot2)
library(edgeR)
#Loading all high quality cells and filtering for lowly expressed genes and cell cycle genes
setwd("/Volumes/guacamole/Software/Final Scripts for Paper _ 01152015/Files")
allcounts_allcells<-read.table("AllCounts_specPops_read_gene_ERCC_filt_FINAL.txt")
setwd("/Volumes/guacamole/Software/Final Scripts for Paper _ 01152015/Files")
oligos<-as.vector(read.table("STAR_oligos_updated_09232015.txt")[,1])
allcounts_allcells_nooligo<-allcounts_allcells[,-na.omit(match(oligos,colnames(allcounts_allcells)))]
#Filtering for expressed by 5 cells at 10 counts
greaterthan0<-allcounts_allcells_nooligo>10
greaterthan0sum<-rowSums(greaterthan0)
allcounts_allcells_nooligo_genefilt<-allcounts_allcells_nooligo[greaterthan0sum>=5,]
glm <- DGEList(counts=allcounts_allcells_nooligo_genefilt)
glm.norm <- calcNormFactors(glm,method="TMM")
load("/Volumes/guacamole/Software/Final Scripts for Paper _ 01152015/Files/Katja_exonic_gene_sizes_ERCC92.RData")
names(exonic.gene.sizes) <- tolower(names(exonic.gene.sizes))
ind <- match(tolower(rownames(glm.norm)), names(exonic.gene.sizes))
exonic.gene.sizes.ord <- exonic.gene.sizes[ind]
genes <- data.frame(gene.symbol=rownames(glm.norm),
exonic.size=exonic.gene.sizes.ord)
fpkm_glm_genefilt_nooligo <- rpkm(glm.norm, gene.length=genes$exonic.size,
normalized.lib.sizes=T, log=F)
setwd("/Volumes/guacamole/Software/Final Scripts for Paper _ 01152015/Files/Ordering")
group1<-as.vector(read.table("group1_10282015_50minModels_quiescent1_consensus_2.txt")[,1])
group2<-as.vector(read.table("group2_10282015_50minModels_active_nondividing_consensus_2.txt")[,1])
group3<-as.vector(read.table("group3_10282015_50minModels_active_dividing_early_consensus_2.txt")[,1])
group4<-as.vector(read.table("group4_10282015_50minModels_active_dividing_late_consensus_2.txt")[,1])
group5<-as.vector(read.table("group5_10282015_50minModels_active_dividing_consensus_2.txt")[,1])
group1_fpkm<-fpkm_glm_genefilt_nooligo[,match(group1,colnames(fpkm_glm_genefilt_nooligo))]
group2_fpkm<-fpkm_glm_genefilt_nooligo[,match(group2,colnames(fpkm_glm_genefilt_nooligo))]
group3_fpkm<-fpkm_glm_genefilt_nooligo[,match(group3,colnames(fpkm_glm_genefilt_nooligo))]
group4_fpkm<-fpkm_glm_genefilt_nooligo[,match(group4,colnames(fpkm_glm_genefilt_nooligo))]
group5_fpkm<-fpkm_glm_genefilt_nooligo[,match(group5,colnames(fpkm_glm_genefilt_nooligo))]
comb_fpkm<-cbind(group2_fpkm,group3_fpkm,group4_fpkm,group5_fpkm)
#c("#9966FF","#c9cc00","#ff9933","#ff3333","#00CCFF")
comb_fpkm_col<-vector(length=length(comb_fpkm[1,]),mode="character")
comb_fpkm_col[match(group1,colnames(comb_fpkm))]<-"#9966FF"
comb_fpkm_col[match(group2,colnames(comb_fpkm))]<-"#c9cc00"
comb_fpkm_col[match(group3,colnames(comb_fpkm))]<-"#ff9933"
comb_fpkm_col[match(group4,colnames(comb_fpkm))]<-"#ff3333"
comb_fpkm_col[match(group5,colnames(comb_fpkm))]<-"#00CCFF"
comb_fac_col<-vector(length=length(comb_fpkm[1,]),mode="character")
comb_fac_col[match(group1,colnames(comb_fpkm))]<-"qNSC-like"
comb_fac_col[match(group2,colnames(comb_fpkm))]<-"aNSC-early"
comb_fac_col[match(group3,colnames(comb_fpkm))]<-"aNSC-mid"
comb_fac_col[match(group4,colnames(comb_fpkm))]<-"aNSC-late"
comb_fac_col[match(group5,colnames(comb_fpkm))]<-"NPC-like"
#Larger plots used for Figure 5D
setwd("/Volumes/guacamole/Software/Final Scripts for Paper _ 01152015/Figure4_Output")
int_genes<-c("Dlx2","Dlx1","Atp1a2","Ntsr2","Gja1","Ascl1","Cdk1","Mki67","Ccna2","Ccnb1","Prc1","Hmgb2","Dcx","Fgfr3","Dlx6as1","Egfr","Nrxn3")
for(i in 1:length(int_genes)){
int_fpkm_glm<-comb_fpkm[match(int_genes,rownames(comb_fpkm)),]
#comb_fpkm_col<-c("#009900","#3366FF","#990000","#CC6600","#FF0066","#000000")
dataframe<-data.frame(data=log2(int_fpkm_glm[i,]+1),col=comb_fpkm_col,fac=comb_fac_col)
dataframe$col<-as.character(dataframe$col)
dataframe$col <- factor(dataframe$col, levels=unique(dataframe$col), ordered = T)
dataframe$fac<-as.character(dataframe$fac)
dataframe$fac <- factor(dataframe$fac, levels=unique(dataframe$fac), ordered = T)
p<-ggplot(dataframe)
p<-p+geom_violin(aes(x=dataframe$fac,y=dataframe$data,fill=dataframe$col),trim=F,scale="width",alpha=0.5,width=0.6)+
geom_jitter(aes(x=dataframe$fac,y=dataframe$data),position = position_jitter(width = .3),alpha=0.7)
p<-p+theme_classic() + theme(
axis.line.x = element_line(colour = 'black', size=0.5, linetype='solid'),
axis.line.y = element_line(colour = 'black', size=0.5, linetype='solid'))
p<-p + theme(legend.position="none")
p<-p+scale_x_discrete(labels=c("aNSC-\nearly","aNSC-\nmid","aNSC-\nlate","NPC-\nlike"))
p<-p+theme(axis.text.y=element_text(size=15))
p<-p+theme(axis.text.x=element_text(size=20))
p<-p+theme(axis.title=element_text(size=20))
p<-p+theme(axis.title.y=element_text(vjust=1))
p<-p+theme(axis.title.x=element_text(vjust=-0.10))
p<-p+labs(y="log2(FPKM+1)")
p<-p+theme(axis.title.x=element_blank())
p<-p+scale_fill_manual(values=c("#c9cc00","#ff9933","#ff3333","#00CCFF"))
pdf(paste(rownames(int_fpkm_glm)[i],"_expression_violin_forGFAPgradientcomparison.pdf",sep=""),width=6,height=3)
print(p)
dev.off()
}
